<!DOCTYPE html>
<html lang="en">
<!-- 
    =======================================================
    HALAMAN: DASHBOARD.HTML
    Halaman inti aplikasi setelah login.
    FITUR:
    - Menampilkan Live Streaming Kamera.
    - Menampilkan hasil deteksi AI secara Real-time (AJAX).
    - Mode dua bahasa (Nama Benda ID/EN).
    =======================================================
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoEarth Dashboard</title>
    <!-- Tailwind CSS (Framework CSS Instan) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4;
        }

        .lang-btn {
            cursor: pointer;
            font-weight: 600;
            color: #9ca3af;
            transition: color 0.2s;
        }

        .lang-btn.active {
            color: #16a34a;
        }

        .lang-btn:hover {
            color: #15803d;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">

    <!-- [1] NAVBAR ATAS -->
    <nav class="bg-white px-6 py-4 shadow-sm flex justify-between items-center z-10">
        <div class="flex items-center gap-3">
            <div
                class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white text-lg shadow-green-200 shadow-lg">
                <i class="fa-solid fa-leaf"></i>
            </div>
            <span class="text-green-600 font-bold text-xl tracking-wide">EcoEarth</span>
        </div>

        <div class="flex items-center gap-6">
            <!-- Pilihan Bahasa -->
            <div class="flex gap-2 text-sm">
                <span onclick="setLanguage('id')" id="btn-id" class="lang-btn">ID</span>
                <span class="text-gray-300">|</span>
                <span onclick="setLanguage('en')" id="btn-en" class="lang-btn">EN</span>
            </div>
            <!-- Tombol Logout -->
            <a href="{{ url_for('logout') }}" class="text-gray-400 hover:text-red-500 transition">
                <i class="fa-solid fa-right-from-bracket text-xl"></i>
            </a>
        </div>
    </nav>

    <!-- [2] KONTEN UTAMA -->
    <main class="flex-grow flex flex-col items-center p-4">
        <div class="w-full max-w-2xl">

            <!-- KONDISI TAB: LIVE CAMERA -->
            {% if active_tab == 'live' %}
            <div class="bg-white rounded-[32px] shadow-lg overflow-hidden mb-6">
                <!-- Judul -->
                <div class="p-6 pb-2 text-center">
                    <h2 class="text-2xl font-bold text-gray-800" data-en="Live Scanning (Cam #{{ cam_index }})"
                        data-id="Pemindaian Langsung (Cam #{{ cam_index }})">Live Scanning (Cam #{{ cam_index }})</h2>
                    <p class="text-gray-500 text-sm" data-en="Point camera at waste object"
                        data-id="Arahkan kamera ke objek sampah">Arahkan kamera ke objek sampah</p>
                </div>

                <!-- Area Video (Gambar dari Flask) -->
                <div class="relative bg-black h-[400px] flex items-center justify-center">
                    <img src="{{ url_for('video_feed') }}" class="h-full w-full object-contain">
                </div>

                <!-- Panel Informasi Deteksi -->
                <div class="p-8">
                    <!-- Kotak Status Utama (Waiting / Detected) -->
                    <div id="live-header"
                        class="bg-white border text-center border-gray-100 rounded-2xl p-6 shadow-sm flex items-center justify-between gap-4 mb-8 transition-all duration-300">
                        <div id="live-icon-container"
                            class="w-16 h-16 rounded-full border-[6px] border-gray-300 text-gray-400 flex items-center justify-center text-3xl font-bold shrink-0">
                            <i id="live-icon" class="fa-solid fa-search"></i>
                        </div>
                        <div class="text-left flex-grow">
                            <h2 id="live-title" class="text-xl font-bold text-gray-900" data-en="Waiting..."
                                data-id="Menunggu...">Waiting...</h2>
                            <p id="live-subtitle" class="text-gray-500 font-medium capitalize"
                                data-en="Detecting objects..." data-id="Mendeteksi objek...">Detecting objects...</p>
                        </div>
                        <div id="live-confidence" class="text-gray-700 font-bold text-lg">0%</div>
                    </div>

                    <!-- Indikator 3 Kotak Kecil (Organic/Anorganic/Non-Trash) -->
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div id="box-organic"
                            class="border border-gray-200 rounded-2xl py-4 flex flex-col items-center gap-2 opacity-40 grayscale transition-all duration-300">
                            <div class="w-4 h-4 rounded-full border-[3px] border-green-500 bg-green-500"></div>
                            <span class="font-semibold text-sm text-gray-600" data-en="Organic"
                                data-id="Organik">Organic</span>
                        </div>
                        <div id="box-anorganic"
                            class="border border-gray-200 rounded-2xl py-4 flex flex-col items-center gap-2 opacity-40 grayscale transition-all duration-300">
                            <div class="w-4 h-4 rounded-full border-[3px] border-yellow-500 bg-yellow-500"></div>
                            <span class="font-semibold text-sm text-gray-600" data-en="Anorganic"
                                data-id="Anorganik">Anorganic</span>
                        </div>
                        <div id="box-nontrash"
                            class="border border-gray-200 rounded-2xl py-4 flex flex-col items-center gap-2 opacity-40 grayscale transition-all duration-300">
                            <div class="w-4 h-4 rounded-full border-[3px] border-blue-500 bg-blue-500"></div>
                            <span class="font-semibold text-sm text-gray-600" data-en="Non-Trash"
                                data-id="Bukan Sampah">Non-Trash</span>
                        </div>
                    </div>

                    <!-- Tombol Kontrol Bawah -->
                    <div class="flex justify-center gap-4">
                        <a href="{{ url_for('switch_camera') }}"
                            class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-xl font-bold shadow-md transition focus:outline-none">
                            <i class="fa-solid fa-sync"></i> <span data-en="Switch Cam" data-id="Ganti Kamera">Switch
                                Cam</span>
                        </a>
                        <a href="{{ url_for('dashboard', tab='menu') }}"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-bold shadow-md transition focus:outline-none">
                            <span data-en="Stop Scan" data-id="Stop Scan">Stop Scan</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- [3] SCRIPT LOGIKA DASHBOARD (UPDATE DATA REAL-TIME) -->
            <script>
                function updateDashboard() {
                    // Ambil data terbaru dari server Python (/status_feed)
                    fetch('/status_feed').then(r => r.json()).then(data => {
                        const k = data.kategori; // Kategori: Organic/Anorganic
                        const lang = localStorage.getItem('lang') || 'en'; // Cek bahasa saat ini

                        // Kamus terjemahan untuk kategori utama
                        const catTrans = {
                            'Organic': { 'en': 'Organic', 'id': 'Organik' },
                            'Anorganic': { 'en': 'Anorganic', 'id': 'Anorganik' },
                            'Recyclable': { 'en': 'Anorganic', 'id': 'Anorganik' },
                            'Non-Trash': { 'en': 'Non-Trash', 'id': 'Bukan Sampah' },
                            'Waiting...': { 'en': 'Waiting...', 'id': 'Menunggu...' }
                        };

                        // Update Judul Besar
                        const titleText = (catTrans[k] && catTrans[k][lang]) ? catTrans[k][lang] : k;
                        document.getElementById('live-title').innerText = titleText;

                        // Update Nama Benda (Pilih nama_en atau nama_id sesuai bahasa)
                        let displayName = "...";
                        if (data.nama_en && data.nama_id) {
                            displayName = (lang === 'en') ? data.nama_en : data.nama_id;
                        } else if (data.nama) {
                            displayName = data.nama.split('_')[0];
                        }

                        // Update Sub-judul
                        if (displayName === '...' || k === 'Waiting...') {
                            const waitText = (lang === 'en') ? 'Detecting objects...' : 'Mendeteksi objek...';
                            document.getElementById('live-subtitle').innerText = waitText;
                        } else {
                            const suffix = (lang === 'en') ? ' detected' : ' terdeteksi';
                            document.getElementById('live-subtitle').innerText = displayName + suffix;
                        }

                        document.getElementById('live-confidence').innerText = data.akurasi;
                        const iconC = document.getElementById('live-icon-container');
                        const icon = document.getElementById('live-icon');

                        // Update Warna Ikon Utama
                        iconC.className = "w-16 h-16 rounded-full border-[6px] flex items-center justify-center text-3xl font-bold shrink-0 transition-all duration-300";

                        if (k === 'Organic') {
                            iconC.classList.add('border-green-500', 'text-green-500'); icon.className = "fa-solid fa-leaf";
                        }
                        else if (k === 'Anorganic' || k === 'Recyclable') {
                            iconC.classList.add('border-yellow-500', 'text-yellow-500'); icon.className = "fa-solid fa-recycle";
                        }
                        else if (k === 'Non-Trash') {
                            iconC.classList.add('border-blue-500', 'text-blue-500'); icon.className = "fa-solid fa-user-shield";
                        }
                        else {
                            iconC.classList.add('border-gray-300', 'text-gray-300'); icon.className = "fa-solid fa-search";
                        }

                        // Update Highlight Kotak Kecil di Bawah
                        const boxes = {
                            'Organic': document.getElementById('box-organic'),
                            'Anorganic': document.getElementById('box-anorganic'),
                            'Recyclable': document.getElementById('box-anorganic'),
                            'Non-Trash': document.getElementById('box-nontrash')
                        };

                        // Reset semua kotak jadi abu-abu dulu
                        for (let key in boxes) {
                            if (boxes[key]) boxes[key].className = "border border-gray-200 rounded-2xl py-4 flex flex-col items-center gap-2 opacity-40 grayscale transition-all duration-300";
                        }

                        // Aktifkan kotak yang sesuai deteksi
                        if (boxes[k]) {
                            boxes[k].classList.remove('opacity-40', 'grayscale');
                            boxes[k].classList.add('opacity-100', 'scale-105', 'shadow-md');

                            if (k === 'Organic') boxes[k].classList.add('bg-green-50', 'border-green-500');
                            if (k === 'Anorganic' || k === 'Recyclable') boxes[k].classList.add('bg-yellow-50', 'border-yellow-500');
                            if (k === 'Non-Trash') boxes[k].classList.add('bg-blue-50', 'border-blue-500');
                        }
                    });
                }
                // Jalankan fungsi update setiap 0.5 detik
                setInterval(updateDashboard, 500);
            </script>

            <!-- KONDISI TAB: MENU UTAMA (READY) -->
            {% else %}
            <div class="bg-white rounded-[32px] shadow-lg p-10 text-center mb-6">
                <div
                    class="w-24 h-24 bg-green-500 rounded-full flex items-center justify-center text-white text-4xl mx-auto mb-6 shadow-green-200 shadow-xl">
                    <i class="fa-solid fa-camera"></i>
                </div>
                <!-- Teks statis dengan dukungan bahasa -->
                <h2 class="text-3xl font-bold text-gray-800 mb-2" data-en="Ready To Classify"
                    data-id="Siap Mengklasifikasi">Ready To Classify</h2>
                <p class="text-gray-500 mb-8 font-medium" data-en="Please start scanning:"
                    data-id="Silakan mulai pemindaian:">Silakan mulai pemindaian:</p>

                <div class="flex justify-center gap-4">
                    <a href="{{ url_for('dashboard', tab='live') }}"
                        class="flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-xl font-bold transition shadow-lg shadow-green-200">
                        <i class="fa-solid fa-video"></i> <span data-en="Live Camera" data-id="Kamera Langsung">Live
                            Camera</span>
                    </a>
                </div>
            </div>

            <!-- Panel Tips Cepat -->
            <div class="bg-white rounded-[24px] p-8 shadow-sm border-2 border-blue-400">
                <h3 class="font-bold text-xl mb-4 text-gray-800" data-en="Quick Tips!" data-id="Tips Cepat!">Quick Tips!
                </h3>
                <ul class="space-y-2 text-gray-600 font-medium">
                    <li class="flex items-center gap-2">
                        <div class="w-1.5 h-1.5 bg-black rounded-full"></div>
                        <span data-en="Ensure enough lighting" data-id="Pastikan cahaya cukup terang">Pastikan cahaya
                            cukup terang</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <div class="w-1.5 h-1.5 bg-black rounded-full"></div>
                        <span data-en="Place waste in center of screen"
                            data-id="Tempatkan sampah di tengah layar">Tempatkan sampah di tengah layar</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <div class="w-1.5 h-1.5 bg-black rounded-full"></div>
                        <span data-en="Keep camera 10-20 cm from object"
                            data-id="Jaga jarak kamera 10-20 cm dari objek">Jaga jarak kamera 10-20 cm dari objek</span>
                    </li>
                </ul>
            </div>
            {% endif %}

        </div>
    </main>

    <!-- [4] SCRIPT PENGATUR BAHASA (GLOBAL) -->
    <script>
        function setLanguage(lang) {
            // Update Teks Label
            document.querySelectorAll('[data-' + lang + ']').forEach(el => {
                el.innerText = el.getAttribute('data-' + lang);
            });
            // Update Seleksi Tombol
            if (document.getElementById('btn-en')) document.getElementById('btn-en').classList.remove('active');
            if (document.getElementById('btn-id')) document.getElementById('btn-id').classList.remove('active');
            if (document.getElementById('btn-' + lang)) document.getElementById('btn-' + lang).classList.add('active');

            localStorage.setItem('lang', lang);
        }

        // Load bahasa tersimpan
        const savedLang = localStorage.getItem('lang') || 'en';
        setLanguage(savedLang);
    </script>
</body>

</html>